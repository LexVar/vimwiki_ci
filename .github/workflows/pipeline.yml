name: Pipeline

on:
  # Triggers the workflow on push or pull request events but only for the master branch
  push:
    branches: [ master ]

jobs:
  build:
    runs-on: self-hosted

    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v2
      
      - name: Convert markdown to HTML
        uses: lifepal/markdown-to-html@v1.2
        with:
          text: $GITHUB_WORKSPACE/index.md
        
  deploy:
    # Dependency, needs build before deploy
    needs: build
    runs-on: self-hosted

    steps:
      - name: Make dir '/var/www/html'
        run: sudo mkdir -p /var/www/html/
      
      - name: Copy to '/var/www/html'
        run: sudo cp $GITHUB_WORKSPACE/*.html /var/www/html/
        
      - name: Start nginx
        run: |
          sudo dnf install -y nginx
          sudo systemctl start nginx
